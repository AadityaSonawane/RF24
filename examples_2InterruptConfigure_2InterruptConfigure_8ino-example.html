<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Optimized high speed nRF24L01+ driver class documentation: examples/InterruptConfigure/InterruptConfigure.ino</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Optimized high speed nRF24L01+ driver class documentation<span id="projectnumber">&#160;1.4.4</span>
   </div>
   <div id="projectbrief">TMRh20 2020 - Optimized fork of the nRF24L01+ driver</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle"><div class="title">examples/InterruptConfigure/InterruptConfigure.ino</div></div>
</div><!--header-->
<div class="contents">
<p >Written by <a href="http://github.com/2bndy5">2bndy5</a> in 2020</p>
<p >This example uses Acknowledgement (ACK) payloads attached to ACK packets to demonstrate how the nRF24L01's IRQ (Interrupt Request) pin can be configured to detect when data is received, or when data has transmitted successfully, or when data has failed to transmit.</p>
<p >This example was written to be used on 2 devices acting as "nodes". Use the Serial Monitor to change each node's behavior.</p>
<div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">/*</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment"> * See documentation at https://nRF24.github.io/RF24</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment"> * See License information at root directory of this library</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment"> * Author: Brendan Doherty (2bndy5)</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment"> */</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span> </div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="preprocessor">#include &lt;SPI.h&gt;</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="preprocessor">#include &quot;<a class="code" href="printf_8h.html">printf.h</a>&quot;</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="preprocessor">#include &quot;<a class="code" href="RF24_8h.html">RF24.h</a>&quot;</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span> </div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="comment">// We will be using the nRF24L01&#39;s IRQ pin for this example</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="preprocessor">#define IRQ_PIN 2                      </span><span class="comment">// this needs to be a digital input capable pin</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="keyword">volatile</span> <span class="keywordtype">bool</span> wait_for_event = <span class="keyword">false</span>;  <span class="comment">// used to wait for an IRQ event to trigger</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span> </div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="comment">// instantiate an object for the nRF24L01 transceiver</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><a id="_a0" name="_a0"></a><a class="code hl_class" href="classRF24.html">RF24</a> radio(7, 8);  <span class="comment">// using pin 7 for the CE pin, and pin 8 for the CSN pin</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span> </div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="comment">// Let these addresses be used for the pair</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span>uint8_t address[][6] = { <span class="stringliteral">&quot;1Node&quot;</span>, <span class="stringliteral">&quot;2Node&quot;</span> };</div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="comment">// It is very helpful to think of an address as a path instead of as</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="comment">// an identifying device destination</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span> </div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="comment">// to use different addresses on a pair of radios, we need a variable to</span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="comment">// uniquely identify which address this radio will use to transmit</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="keywordtype">bool</span> radioNumber = 1;  <span class="comment">// 0 uses address[0] to transmit, 1 uses address[1] to transmit</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span> </div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="comment">// Used to control whether this node is sending or receiving</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span><span class="keywordtype">bool</span> role = <span class="keyword">false</span>;  <span class="comment">// true = TX node, false = RX node</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span> </div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span><span class="comment">// For this example, we&#39;ll be using a payload containing</span></div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span><span class="comment">// a string that changes on every transmission. (successful or not)</span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span><span class="comment">// Make a couple arrays of payloads &amp; an iterator to traverse them</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span><span class="keyword">const</span> uint8_t tx_pl_size = 5;</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="keyword">const</span> uint8_t ack_pl_size = 4;</div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>uint8_t pl_iterator = 0;</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span><span class="comment">// The &quot; + 1&quot; compensates for the c-string&#39;s NULL terminating 0</span></div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span><span class="keywordtype">char</span> tx_payloads[][tx_pl_size + 1] = { <span class="stringliteral">&quot;Ping &quot;</span>, <span class="stringliteral">&quot;Pong &quot;</span>, <span class="stringliteral">&quot;Radio&quot;</span>, <span class="stringliteral">&quot;1FAIL&quot;</span> };</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span><span class="keywordtype">char</span> ack_payloads[][ack_pl_size + 1] = { <span class="stringliteral">&quot;Yak &quot;</span>, <span class="stringliteral">&quot;Back&quot;</span>, <span class="stringliteral">&quot; ACK&quot;</span> };</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span> </div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span><span class="keywordtype">void</span> interruptHandler();  <span class="comment">// prototype to handle IRQ events</span></div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span><span class="keywordtype">void</span> printRxFifo();       <span class="comment">// prototype to print RX FIFO with 1 buffer</span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span> </div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span> </div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span><span class="keywordtype">void</span> setup() {</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>  Serial.begin(115200);</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>  <span class="keywordflow">while</span> (!Serial) {</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>    <span class="comment">// some boards need to wait to ensure access to serial over USB</span></div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>  }</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span> </div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>  <span class="comment">// initialize the transceiver on the SPI bus</span></div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>  <span class="keywordflow">if</span> (!radio.begin()) {</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>    Serial.println(F(<span class="stringliteral">&quot;radio hardware is not responding!!&quot;</span>));</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>    <span class="keywordflow">while</span> (1) {}  <span class="comment">// hold in infinite loop</span></div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>  }</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span> </div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>  <span class="comment">// print example&#39;s introductory prompt</span></div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>  Serial.println(F(<span class="stringliteral">&quot;RF24/examples/InterruptConfigure&quot;</span>));</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span> </div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>  <span class="comment">// To set the radioNumber via the Serial monitor on startup</span></div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>  Serial.println(F(<span class="stringliteral">&quot;Which radio is this? Enter &#39;0&#39; or &#39;1&#39;. Defaults to &#39;0&#39;&quot;</span>));</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>  <span class="keywordflow">while</span> (!Serial.available()) {</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>    <span class="comment">// wait for user input</span></div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>  }</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>  <span class="keywordtype">char</span> input = Serial.parseInt();</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>  radioNumber = input == 1;</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>  Serial.print(F(<span class="stringliteral">&quot;radioNumber = &quot;</span>));</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>  Serial.println((<span class="keywordtype">int</span>)radioNumber);</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span> </div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>  <span class="comment">// role variable is hardcoded to RX behavior, inform the user of this</span></div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>  Serial.println(F(<span class="stringliteral">&quot;*** PRESS &#39;T&#39; to begin transmitting to the other node&quot;</span>));</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span> </div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>  <span class="comment">// setup the IRQ_PIN</span></div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>  <a id="a1" name="a1"></a><a class="code hl_define" href="group__Porting__General.html#ga361649efb4f1e2fa3c870ca203497d5e">pinMode</a>(IRQ_PIN, <a id="a2" name="a2"></a><a class="code hl_define" href="group__Porting__General.html#ga1bb283bd7893b9855e2f23013891fc82">INPUT</a>);</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>  attachInterrupt(digitalPinToInterrupt(IRQ_PIN), interruptHandler, FALLING);</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>  <span class="comment">// IMPORTANT: do not call radio.available() before calling</span></div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>  <span class="comment">// radio.whatHappened() when the interruptHandler() is triggered by the</span></div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>  <span class="comment">// IRQ pin FALLING event. According to the datasheet, the pipe information</span></div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>  <span class="comment">// is unreliable during the IRQ pin FALLING transition.</span></div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span> </div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>  <span class="comment">// Set the PA Level low to try preventing power supply related problems</span></div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>  <span class="comment">// because these examples are likely run with nodes in close proximity to</span></div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>  <span class="comment">// each other.</span></div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>  radio.setPALevel(<a id="a3" name="a3"></a><a class="code hl_enumvalue" href="group__PALevel.html#gga1e4cd0bea93e6b43422855fb0120aacea7d8d09f4a047b7c22655e56c98ca010c">RF24_PA_LOW</a>);  <span class="comment">// RF24_PA_MAX is default.</span></div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span> </div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>  <span class="comment">// For this example we use acknowledgment (ACK) payloads to trigger the</span></div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>  <span class="comment">// IRQ pin when data is received on the TX node.</span></div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>  <span class="comment">// to use ACK payloads, we need to enable dynamic payload lengths</span></div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>  radio.enableDynamicPayloads();  <span class="comment">// ACK payloads are dynamically sized</span></div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span> </div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>  <span class="comment">// Acknowledgement packets have no payloads by default. We need to enable</span></div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>  <span class="comment">// this feature for all nodes (TX &amp; RX) to use ACK payloads.</span></div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>  radio.enableAckPayload();</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>  <span class="comment">// Fot this example, we use the same address to send data back and forth</span></div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span> </div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>  <span class="comment">// set the TX address of the RX node into the TX pipe</span></div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>  radio.openWritingPipe(address[radioNumber]);  <span class="comment">// always uses pipe 0</span></div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span> </div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>  <span class="comment">// set the RX address of the TX node into a RX pipe</span></div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>  radio.openReadingPipe(1, address[!radioNumber]);  <span class="comment">// using pipe 1</span></div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span> </div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>  <span class="comment">// additional setup specific to the node&#39;s role</span></div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>  <span class="keywordflow">if</span> (role) {</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>    <span class="comment">// setup for TX mode</span></div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>    radio.stopListening();  <span class="comment">// put radio in TX mode</span></div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span> </div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>    <span class="comment">// setup for RX mode</span></div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span> </div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>    <span class="comment">// let IRQ pin only trigger on &quot;data ready&quot; event in RX mode</span></div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>    radio.maskIRQ(1, 1, 0);  <span class="comment">// args = &quot;data_sent&quot;, &quot;data_fail&quot;, &quot;data_ready&quot;</span></div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span> </div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>    <span class="comment">// Fill the TX FIFO with 3 ACK payloads for the first 3 received</span></div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>    <span class="comment">// transmissions on pipe 1</span></div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>    radio.writeAckPayload(1, &amp;ack_payloads[0], ack_pl_size);</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>    radio.writeAckPayload(1, &amp;ack_payloads[1], ack_pl_size);</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>    radio.writeAckPayload(1, &amp;ack_payloads[2], ack_pl_size);</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span> </div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>    radio.startListening();  <span class="comment">// put radio in RX mode</span></div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>  }</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span> </div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>  <span class="comment">// For debugging info</span></div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>  <span class="comment">// printf_begin();             // needed only once for printing details</span></div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>  <span class="comment">// radio.printDetails();       // (smaller) function that prints raw register values</span></div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>  <span class="comment">// radio.printPrettyDetails(); // (larger) function that prints human readable data</span></div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>}</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span> </div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span><span class="keywordtype">void</span> loop() {</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>  <span class="keywordflow">if</span> (role &amp;&amp; !wait_for_event) {</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span> </div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>    <span class="comment">// delay(1); // wait for IRQ pin to fully RISE</span></div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span> </div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>    <span class="comment">// This device is a TX node. This if block is only triggered when</span></div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>    <span class="comment">// NOT waiting for an IRQ event to happen</span></div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span> </div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>    <span class="keywordflow">if</span> (pl_iterator == 0) {</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>      <span class="comment">// Test the &quot;data ready&quot; event with the IRQ pin</span></div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span> </div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>      Serial.println(F(<span class="stringliteral">&quot;\nConfiguring IRQ pin to ignore the &#39;data sent&#39; event&quot;</span>));</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>      radio.maskIRQ(<span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>);  <span class="comment">// args = &quot;data_sent&quot;, &quot;data_fail&quot;, &quot;data_ready&quot;</span></div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>      Serial.println(F(<span class="stringliteral">&quot;   Pinging RX node for &#39;data ready&#39; event...&quot;</span>));</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span> </div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pl_iterator == 1) {</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>      <span class="comment">// Test the &quot;data sent&quot; event with the IRQ pin</span></div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span> </div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>      Serial.println(F(<span class="stringliteral">&quot;\nConfiguring IRQ pin to ignore the &#39;data ready&#39; event&quot;</span>));</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>      radio.maskIRQ(<span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">true</span>);  <span class="comment">// args = &quot;data_sent&quot;, &quot;data_fail&quot;, &quot;data_ready&quot;</span></div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>      Serial.println(F(<span class="stringliteral">&quot;   Pinging RX node for &#39;data sent&#39; event...&quot;</span>));</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span> </div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pl_iterator == 2) {</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>      <span class="comment">// Use this iteration to fill the RX node&#39;s FIFO which sets us up for the next test.</span></div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span> </div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>      <span class="comment">// write() uses virtual interrupt flags that work despite the masking of the IRQ pin</span></div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>      radio.maskIRQ(1, 1, 1);  <span class="comment">// disable IRQ masking for this step</span></div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span> </div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>      Serial.println(F(<span class="stringliteral">&quot;\nSending 1 payload to fill RX node&#39;s FIFO. IRQ pin is neglected.&quot;</span>));</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>      <span class="comment">// write() will call flush_tx() on &#39;data fail&#39; events</span></div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>      <span class="keywordflow">if</span> (radio.write(&amp;tx_payloads[pl_iterator], tx_pl_size)) {</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>        <span class="keywordflow">if</span> (radio.rxFifoFull()) {</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>          Serial.println(F(<span class="stringliteral">&quot;RX node&#39;s FIFO is full; it is not listening any more&quot;</span>));</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>          Serial.println(<span class="stringliteral">&quot;Transmission successful, but the RX node might still be listening.&quot;</span>);</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>        }</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>        Serial.println(F(<span class="stringliteral">&quot;Transmission failed or timed out. Continuing anyway.&quot;</span>));</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>        radio.flush_tx();  <span class="comment">// discard payload(s) that failed to transmit</span></div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>      }</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span> </div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pl_iterator == 3) {</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>      <span class="comment">// test the &quot;data fail&quot; event with the IRQ pin</span></div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span> </div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>      Serial.println(F(<span class="stringliteral">&quot;\nConfiguring IRQ pin to reflect all events&quot;</span>));</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>      radio.maskIRQ(0, 0, 0);  <span class="comment">// args = &quot;data_sent&quot;, &quot;data_fail&quot;, &quot;data_ready&quot;</span></div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>      Serial.println(F(<span class="stringliteral">&quot;   Pinging inactive RX node for &#39;data fail&#39; event...&quot;</span>));</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>    }</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span> </div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>    <span class="keywordflow">if</span> (pl_iterator &lt; 4 &amp;&amp; pl_iterator != 2) {</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span> </div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>      <span class="comment">// IRQ pin is LOW when activated. Otherwise it is always HIGH</span></div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>      <span class="comment">// Wait until IRQ pin is activated.</span></div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>      wait_for_event = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span> </div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>      <span class="comment">// use the non-blocking call to write a payload and begin transmission</span></div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>      <span class="comment">// the &quot;false&quot; argument means we are expecting an ACK packet response</span></div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>      radio.startFastWrite(tx_payloads[pl_iterator++], tx_pl_size, <span class="keyword">false</span>);</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span> </div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>      <span class="comment">// In this example, the &quot;data fail&quot; event is always configured to</span></div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>      <span class="comment">// trigger the IRQ pin active. Because the auto-ACK feature is on by</span></div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>      <span class="comment">// default, we don&#39;t need a timeout check to prevent an infinite loop.</span></div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span> </div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pl_iterator == 4) {</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>      <span class="comment">// all IRQ tests are done; flush_tx() and print the ACK payloads for fun</span></div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span> </div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>      <span class="comment">// CE pin is still HIGH which consumes more power. Example is now idling so...</span></div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>      radio.stopListening();  <span class="comment">// ensure CE pin is LOW</span></div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>      <span class="comment">// stopListening() also calls flush_tx() when ACK payloads are enabled</span></div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span> </div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>      printRxFifo();</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>      pl_iterator++;</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span> </div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span> </div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>      <span class="comment">// inform user what to do next</span></div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>      Serial.println(F(<span class="stringliteral">&quot;\n*** PRESS &#39;T&#39; to restart the transmissions&quot;</span>));</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>      Serial.println(F(<span class="stringliteral">&quot;*** PRESS &#39;R&#39; to change to Receive role\n&quot;</span>));</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span> </div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span> </div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pl_iterator == 2) {</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>      pl_iterator++;  <span class="comment">// proceed from step 3 to last step (stop at step 4 for readability)</span></div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>    }</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span> </div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!role) {</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>    <span class="comment">// This device is a RX node</span></div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span> </div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>    <span class="keywordflow">if</span> (radio.rxFifoFull()) {</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>      <span class="comment">// wait until RX FIFO is full then stop listening</span></div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span> </div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>      <a id="a4" name="a4"></a><a class="code hl_define" href="group__Porting__General.html#ga70a331e8ddf9acf9d33c47b71cda4c5f">delay</a>(100);             <span class="comment">// let ACK payload finish transmitting</span></div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>      radio.stopListening();  <span class="comment">// also discards unused ACK payloads</span></div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>      printRxFifo();          <span class="comment">// flush the RX FIFO</span></div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span> </div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>      <span class="comment">// Fill the TX FIFO with 3 ACK payloads for the first 3 received</span></div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>      <span class="comment">// transmissions on pipe 1.</span></div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>      radio.writeAckPayload(1, &amp;ack_payloads[0], ack_pl_size);</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>      radio.writeAckPayload(1, &amp;ack_payloads[1], ack_pl_size);</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>      radio.writeAckPayload(1, &amp;ack_payloads[2], ack_pl_size);</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span> </div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>      <a class="code hl_define" href="group__Porting__General.html#ga70a331e8ddf9acf9d33c47b71cda4c5f">delay</a>(100);              <span class="comment">// let TX node finish its role</span></div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>      radio.startListening();  <span class="comment">// We&#39;re ready to start over. Begin listening.</span></div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>    }</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span> </div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>  }  <span class="comment">// role</span></div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span> </div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>  <span class="keywordflow">if</span> (Serial.available()) {</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>    <span class="comment">// change the role via the serial monitor</span></div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span> </div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>    <span class="keywordtype">char</span> c = toupper(Serial.read());</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>    <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;T&#39;</span>) {</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>      <span class="comment">// Become the TX node</span></div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>      <span class="keywordflow">if</span> (!role)</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>        Serial.println(F(<span class="stringliteral">&quot;*** CHANGING TO TRANSMIT ROLE -- PRESS &#39;R&#39; TO SWITCH BACK&quot;</span>));</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>      <span class="keywordflow">else</span></div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>        Serial.println(F(<span class="stringliteral">&quot;*** RESTARTING IRQ PIN TEST ***&quot;</span>));</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span> </div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>      role = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>      wait_for_event = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>      pl_iterator = 0;   <span class="comment">// reset the iterator</span></div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>      radio.flush_tx();  <span class="comment">// discard any payloads in the TX FIFO</span></div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span> </div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>      <span class="comment">// startListening() clears the IRQ masks also. This is required for</span></div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>      <span class="comment">// continued TX operations when a transmission fails.</span></div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>      radio.stopListening();  <span class="comment">// this also discards any unused ACK payloads</span></div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span> </div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;R&#39;</span> &amp;&amp; role) {</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>      <span class="comment">// Become the RX node</span></div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>      Serial.println(F(<span class="stringliteral">&quot;*** CHANGING TO RECEIVE ROLE -- PRESS &#39;T&#39; TO SWITCH BACK&quot;</span>));</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span> </div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>      role = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span> </div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>      radio.maskIRQ(0, 0, 0);  <span class="comment">// the IRQ pin should only trigger on &quot;data ready&quot; event</span></div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span> </div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>      <span class="comment">// Fill the TX FIFO with 3 ACK payloads for the first 3 received</span></div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>      <span class="comment">// transmissions on pipe 1</span></div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>      radio.flush_tx();  <span class="comment">// make sure there is room for 3 new ACK payloads</span></div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>      radio.writeAckPayload(1, &amp;ack_payloads[0], ack_pl_size);</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>      radio.writeAckPayload(1, &amp;ack_payloads[1], ack_pl_size);</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>      radio.writeAckPayload(1, &amp;ack_payloads[2], ack_pl_size);</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>      radio.startListening();</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>    }</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>  }  <span class="comment">// Serial.available()</span></div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>}  <span class="comment">// loop</span></div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span> </div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span> </div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span><span class="keywordtype">void</span> interruptHandler() {</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>  <span class="comment">// print IRQ status and all masking flags&#39; states</span></div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span> </div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>  Serial.println(F(<span class="stringliteral">&quot;\tIRQ pin is actively LOW&quot;</span>));  <span class="comment">// show that this function was called</span></div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>  <a id="a5" name="a5"></a><a class="code hl_define" href="group__Porting__General.html#ga9384257bf5d5c1aae675b22cc3ecb91a">delayMicroseconds</a>(250);</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>  <span class="keywordtype">bool</span> tx_ds, tx_df, rx_dr;                 <span class="comment">// declare variables for IRQ masks</span></div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>  radio.whatHappened(tx_ds, tx_df, rx_dr);  <span class="comment">// get values for IRQ masks</span></div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>  <span class="comment">// whatHappened() clears the IRQ masks also. This is required for</span></div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>  <span class="comment">// continued TX operations when a transmission fails.</span></div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>  <span class="comment">// clearing the IRQ masks resets the IRQ pin to its inactive state (HIGH)</span></div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span> </div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>  Serial.print(F(<span class="stringliteral">&quot;\tdata_sent: &quot;</span>));</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>  Serial.print(tx_ds);  <span class="comment">// print &quot;data sent&quot; mask state</span></div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>  Serial.print(F(<span class="stringliteral">&quot;, data_fail: &quot;</span>));</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>  Serial.print(tx_df);  <span class="comment">// print &quot;data fail&quot; mask state</span></div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>  Serial.print(F(<span class="stringliteral">&quot;, data_ready: &quot;</span>));</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>  Serial.println(rx_dr);  <span class="comment">// print &quot;data ready&quot; mask state</span></div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span> </div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>  <span class="keywordflow">if</span> (tx_df)           <span class="comment">// if TX payload failed</span></div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>    radio.flush_tx();  <span class="comment">// clear all payloads from the TX FIFO</span></div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span> </div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>  <span class="comment">// print if test passed or failed. Unintentional fails mean the RX node was not listening.</span></div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>  <span class="comment">// pl_iterator has already been incremented by now</span></div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>  <span class="keywordflow">if</span> (pl_iterator &lt;= 1) {</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>    Serial.print(F(<span class="stringliteral">&quot;   &#39;Data Ready&#39; event test &quot;</span>));</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>    Serial.println(rx_dr ? F(<span class="stringliteral">&quot;passed&quot;</span>) : F(<span class="stringliteral">&quot;failed&quot;</span>));</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pl_iterator == 2) {</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>    Serial.print(F(<span class="stringliteral">&quot;   &#39;Data Sent&#39; event test &quot;</span>));</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>    Serial.println(tx_ds ? F(<span class="stringliteral">&quot;passed&quot;</span>) : F(<span class="stringliteral">&quot;failed&quot;</span>));</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pl_iterator == 4) {</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>    Serial.print(F(<span class="stringliteral">&quot;   &#39;Data Fail&#39; event test &quot;</span>));</div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>    Serial.println(tx_df ? F(<span class="stringliteral">&quot;passed&quot;</span>) : F(<span class="stringliteral">&quot;failed&quot;</span>));</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>  }</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>  wait_for_event = <span class="keyword">false</span>;  <span class="comment">// ready to continue with loop() operations</span></div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>}  <span class="comment">// interruptHandler</span></div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span> </div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span> </div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span><span class="keywordtype">void</span> printRxFifo() {</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>  <span class="keywordflow">if</span> (radio.available()) {  <span class="comment">// if there is data in the RX FIFO</span></div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>    <span class="comment">// to flush the data from the RX FIFO, we&#39;ll fetch it all using 1 buffer</span></div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span> </div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>    uint8_t pl_size = !role ? tx_pl_size : ack_pl_size;</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>    <span class="keywordtype">char</span> rx_fifo[pl_size * 3 + 1];  <span class="comment">// RX FIFO is full &amp; we know ACK payloads&#39; size</span></div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>    <span class="keywordflow">if</span> (radio.rxFifoFull()) {</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>      rx_fifo[pl_size * 3] = 0;           <span class="comment">// add a NULL terminating char to use as a c-string</span></div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>      radio.read(&amp;rx_fifo, pl_size * 3);  <span class="comment">// this clears the RX FIFO (for this example)</span></div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>      uint8_t i = 0;</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>      <span class="keywordflow">while</span> (radio.available()) {</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>        radio.read(&amp;rx_fifo + (i * pl_size), pl_size);</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>        i++;</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>      }</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>      rx_fifo[i * pl_size] = 0;  <span class="comment">// add a NULL terminating char to use as a c-string</span></div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>    }</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>    Serial.print(F(<span class="stringliteral">&quot;Complete RX FIFO: &quot;</span>));</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>    Serial.println(rx_fifo);  <span class="comment">// print the entire RX FIFO with 1 buffer</span></div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>  }</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>}</div>
<div class="ttc" id="aRF24_8h_html"><div class="ttname"><a href="RF24_8h.html">RF24.h</a></div></div>
<div class="ttc" id="aclassRF24_html"><div class="ttname"><a href="classRF24.html">RF24</a></div><div class="ttdoc">Driver class for nRF24L01(+) 2.4GHz Wireless Transceiver.</div><div class="ttdef"><b>Definition:</b> <a href="RF24_8h_source.html#l00115">RF24.h:116</a></div></div>
<div class="ttc" id="agroup__PALevel_html_gga1e4cd0bea93e6b43422855fb0120aacea7d8d09f4a047b7c22655e56c98ca010c"><div class="ttname"><a href="group__PALevel.html#gga1e4cd0bea93e6b43422855fb0120aacea7d8d09f4a047b7c22655e56c98ca010c">RF24_PA_LOW</a></div><div class="ttdeci">@ RF24_PA_LOW</div><div class="ttdef"><b>Definition:</b> <a href="RF24_8h_source.html#l00050">RF24.h:50</a></div></div>
<div class="ttc" id="agroup__Porting__General_html_ga1bb283bd7893b9855e2f23013891fc82"><div class="ttname"><a href="group__Porting__General.html#ga1bb283bd7893b9855e2f23013891fc82">INPUT</a></div><div class="ttdeci">#define INPUT</div><div class="ttdef"><b>Definition:</b> <a href="RF24__arch__config_8h_source.html#l00066">RF24_arch_config.h:66</a></div></div>
<div class="ttc" id="agroup__Porting__General_html_ga361649efb4f1e2fa3c870ca203497d5e"><div class="ttname"><a href="group__Porting__General.html#ga361649efb4f1e2fa3c870ca203497d5e">pinMode</a></div><div class="ttdeci">#define pinMode(pin, direction)</div><div class="ttdef"><b>Definition:</b> <a href="RF24__arch__config_8h_source.html#l00069">RF24_arch_config.h:69</a></div></div>
<div class="ttc" id="agroup__Porting__General_html_ga70a331e8ddf9acf9d33c47b71cda4c5f"><div class="ttname"><a href="group__Porting__General.html#ga70a331e8ddf9acf9d33c47b71cda4c5f">delay</a></div><div class="ttdeci">#define delay(milisec)</div><div class="ttdef"><b>Definition:</b> <a href="RF24__arch__config_8h_source.html#l00070">RF24_arch_config.h:70</a></div></div>
<div class="ttc" id="agroup__Porting__General_html_ga9384257bf5d5c1aae675b22cc3ecb91a"><div class="ttname"><a href="group__Porting__General.html#ga9384257bf5d5c1aae675b22cc3ecb91a">delayMicroseconds</a></div><div class="ttdeci">#define delayMicroseconds(usec)</div><div class="ttdef"><b>Definition:</b> <a href="RF24__arch__config_8h_source.html#l00071">RF24_arch_config.h:71</a></div></div>
<div class="ttc" id="aprintf_8h_html"><div class="ttname"><a href="printf_8h.html">printf.h</a></div></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Jul 19 2022 12:00:22 for Optimized high speed nRF24L01+ driver class documentation by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
